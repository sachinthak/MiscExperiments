{
    "collab_server" : "",
    "contents" : "library(mvtnorm)\nlibrary(data.table)\nlibrary(ggplot2)\n\n# set ground truth \n#(to simulate simultaneous equations example in Chap 14 of Using Econometrics - 6th Ed by\n# Studenmund)\nbeta1 <- -1\nbeta2 <- 1\nalpha1 <- 1\nalpha2 <- 1\n\n# noise parameters\nsig2S  <- 3\nsig2D <- 2\nsig2X <- 1\nsig2Z <- 4\nuX <- 3\nuZ <- 5\nprosqr <- 0.4 \n\n# Number of  observations used to fit the regression models\nN <- 50\n\n# Number of simulation runs to get the distribution of estimates\nNsim <- 5000\n\n\n\n\n\n# pre allocate memory\nbeta1SmpOLS <- array(dim = Nsim )\nbeta2SmpOLS <- array(dim = Nsim )\nalpha1SmpOLS <- array(dim = Nsim )\nalpha2SmpOLS <- array(dim = Nsim )\nbeta1IV <- array(dim = Nsim )\nbeta2IV <- array(dim = Nsim )\nalpha1IV <- array(dim = Nsim )\nalpha2IV <- array(dim = Nsim )\n\n\ncovsqrXZ <- prosqr*sig2X*sig2Z\ncov <- matrix(data = c(sig2X,sqrt(covsqrXZ), sqrt(covsqrXZ), sig2Z), nrow = 2 )\n\nfor (j in 1:Nsim) {\n  \n  XZsmp <- rmvnorm(n = N, mean = c(uX,uZ),sigma = cov)\n  Xsmp <- XZsmp[,1]\n  Zsmp <- XZsmp[,2]\n  epsDemand <- rnorm(N,0,sqrt(sig2D))\n  epsSupply <-rnorm(N,0,sqrt(sig2S))\n  \n  Psmp <- 1/(beta1-alpha1)*(alpha2*Zsmp - beta2*Xsmp + epsSupply - epsDemand)\n  Qsmp <- beta1*Psmp +beta2*Xsmp + epsDemand\n  \n  \n  \n  dat <- data.table(Q = Qsmp, X = Xsmp, Z = Zsmp, P = Psmp)\n  \n  fitDemandOLS <- lm(data = dat, formula = 'Q ~ 1 + P + X')\n  fitSupplyOLS <- lm(data = dat, formula = 'Q ~ 1 + P + Z')\n  fitFirstStage <- lm(data = dat, formula = 'P ~ 1 + X + Z')\n  dat$PHat <- predict(fitFirstStage,dat)\n  \n  fitDemandSecondStage <- lm(data = dat, formula = 'Q ~ 1 + PHat + X')\n  fitSupplySecondStage <- lm(data = dat, formula = 'Q ~ 1 + PHat + Z')\n  \n  \n  beta1SmpOLS[j] <- as.numeric(coef(fitDemandOLS)['P'])\n  beta2SmpOLS[j] <- as.numeric(coef(fitDemandOLS)['X'])\n  alpha1SmpOLS[j] <- as.numeric(coef(fitSupplyOLS)['P'])\n  alpha2SmpOLS[j] <- as.numeric(coef(fitSupplyOLS)['Z'])\n  beta1IV[j] <- as.numeric(coef(fitDemandSecondStage)['PHat'])\n  beta2IV[j] <- as.numeric(coef(fitDemandSecondStage)['X'])\n  alpha1IV[j] <- as.numeric(coef(fitSupplySecondStage)['PHat'])\n  alpha2IV[j] <- as.numeric(coef(fitSupplySecondStage)['Z'])\n  \n}\n\nsimDat <- data.table( beta1SmpOLS = beta1SmpOLS,\n                      beta2SmpOLS = beta2SmpOLS,\n                      alpha1SmpOLS = alpha1SmpOLS,\n                      alpha2SmpOLS = alpha2SmpOLS,\n                      beta1IV = beta1IV,\n                      beta2IV = beta2IV,\n                      alpha1IV = alpha1IV,\n                      alpha2IV = alpha2IV )\n\n\nmeltSimDat <- melt.data.table(simDat, measure.vars = c('beta1SmpOLS','beta2SmpOLS','alpha1SmpOLS','alpha2SmpOLS',\n                                                       'beta1IV','beta2IV','alpha1IV','alpha2IV'), value.name = 'prediction')\n\n\nggplot(meltSimDat[variable %in% c('beta1SmpOLS','beta1IV')]) + geom_density(aes(x=prediction, col = variable)) + scale_x_continuous(limits = c(-5,5)) + geom_vline(aes(xintercept=beta1))\nggplot(meltSimDat[variable %in% c('alpha1SmpOLS','alpha1IV')]) + geom_density(aes(x=prediction, col = variable)) + scale_x_continuous(limits = c(-5,5)) + geom_vline(aes(xintercept=alpha1))\nggplot(meltSimDat[variable %in% c('beta2SmpOLS','beta2IV')]) + geom_density(aes(x=prediction, col = variable)) + scale_x_continuous(limits = c(-2.5,2.5)) + geom_vline(aes(xintercept=beta2))\nggplot(meltSimDat[variable %in% c('alpha2SmpOLS','alpha2IV')]) + geom_density(aes(x=prediction, col = variable)) + scale_x_continuous(limits = c(-2.5,2.5)) + geom_vline(aes(xintercept=alpha2))\n\n",
    "created" : 1495545626561.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3490440311",
    "id" : "4287E42F",
    "lastKnownWriteTime" : 1495545652,
    "last_content_update" : 1495545652027,
    "path" : "~/my_stuff/current work/MiscExperiments/SimulatingSimultaneousSystems/OLSbias.R",
    "project_path" : "SimulatingSimultaneousSystems/OLSbias.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}